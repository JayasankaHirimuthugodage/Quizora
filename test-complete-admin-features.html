<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Features Test - Quizora</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.warning {
            background: #ffc107;
            color: #212529;
        }
        button.warning:hover {
            background: #e0a800;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .user-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
        }
        .user-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .user-info {
            font-size: 0.9em;
            margin: 5px 0;
        }
        .role-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .role-admin { background: #e7c3f7; color: #6f42c1; }
        .role-teacher { background: #b3d7ff; color: #0066cc; }
        .role-student { background: #b8f5b8; color: #2d5a2d; }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        .form-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        #userToEdit, #userToDelete {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Admin Features Testing Interface</h1>
        <p>Complete testing interface for admin user management features including Add, Edit, Delete, and Password Reset.</p>
        
        <div id="loginSection" class="test-section">
            <h3>üîê Admin Authentication</h3>
            <button onclick="loginAsAdmin()">Login as Admin</button>
            <button onclick="checkAuthStatus()">Check Auth Status</button>
            <div id="authResult" class="result"></div>
        </div>
    </div>

    <div class="container">
        <h2>üë• User Management Operations</h2>
        
        <div class="test-section">
            <h3>üìã View All Users</h3>
            <button onclick="getAllUsers()">Fetch All Users</button>
            <button onclick="getUserStats()">Get User Statistics</button>
            <div id="usersResult" class="result"></div>
            <div id="usersList" class="user-list"></div>
        </div>

        <div class="test-section">
            <h3>‚ûï Add New User</h3>
            <div class="form-section">
                <label>User Type:</label>
                <select id="newUserRole" onchange="toggleUserFields()">
                    <option value="student">Student</option>
                    <option value="teacher">Teacher</option>
                    <option value="admin">Admin</option>
                </select>
                
                <label>Name:</label>
                <input type="text" id="newUserName" placeholder="Full Name" value="John Doe">
                
                <label>Email:</label>
                <input type="email" id="newUserEmail" placeholder="email@example.com" value="john.doe@example.com">
                
                <label>Password:</label>
                <input type="password" id="newUserPassword" placeholder="Password" value="TempPass123">
                
                <div id="studentFields" style="display: block;">
                    <label>Student ID:</label>
                    <input type="text" id="newUserStudentId" placeholder="ST2024001" value="ST2024001">
                    
                    <label>Course:</label>
                    <input type="text" id="newUserCourse" placeholder="Computer Science" value="Computer Science">
                    
                    <label>Enrollment Year:</label>
                    <input type="number" id="newUserYear" value="2024" min="2000" max="2030">
                </div>
                
                <div id="teacherFields" style="display: none;">
                    <label>Employee ID:</label>
                    <input type="text" id="newUserEmployeeId" placeholder="EMP001" value="EMP001">
                    
                    <label>Department:</label>
                    <input type="text" id="newUserDepartment" placeholder="Computer Science" value="Computer Science">
                    
                    <label>Subjects:</label>
                    <input type="text" id="newUserSubjects" placeholder="Math, Physics" value="Data Structures, Algorithms">
                </div>
                
                <label>Phone (Optional):</label>
                <input type="tel" id="newUserPhone" placeholder="+1234567890" value="">
                
                <label>Address (Optional):</label>
                <textarea id="newUserAddress" placeholder="Address" rows="2"></textarea>
            </div>
            <button class="success" onclick="createUser()">Create User</button>
            <div id="createResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>‚úèÔ∏è Edit User</h3>
            <button onclick="selectUserToEdit()">Select User to Edit</button>
            <div id="userToEdit"></div>
            <div id="editUserForm" style="display: none;">
                <div class="form-section">
                    <label>Name:</label>
                    <input type="text" id="editUserName" placeholder="Full Name">
                    
                    <label>Email:</label>
                    <input type="email" id="editUserEmail" placeholder="email@example.com">
                    
                    <label>Role:</label>
                    <select id="editUserRole" onchange="toggleEditUserFields()">
                        <option value="student">Student</option>
                        <option value="teacher">Teacher</option>
                        <option value="admin">Admin</option>
                    </select>
                    
                    <label>Status:</label>
                    <select id="editUserStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="suspended">Suspended</option>
                    </select>
                    
                    <div id="editStudentFields">
                        <label>Student ID:</label>
                        <input type="text" id="editUserStudentId" placeholder="ST2024001">
                        
                        <label>Course:</label>
                        <input type="text" id="editUserCourse" placeholder="Computer Science">
                        
                        <label>Enrollment Year:</label>
                        <input type="number" id="editUserYear" min="2000" max="2030">
                    </div>
                    
                    <div id="editTeacherFields">
                        <label>Employee ID:</label>
                        <input type="text" id="editUserEmployeeId" placeholder="EMP001">
                        
                        <label>Department:</label>
                        <input type="text" id="editUserDepartment" placeholder="Computer Science">
                        
                        <label>Subjects:</label>
                        <input type="text" id="editUserSubjects" placeholder="Math, Physics">
                    </div>
                    
                    <label>Phone (Optional):</label>
                    <input type="tel" id="editUserPhone" placeholder="+1234567890">
                    
                    <label>Address (Optional):</label>
                    <textarea id="editUserAddress" placeholder="Address" rows="2"></textarea>
                </div>
                <button class="warning" onclick="updateUser()">Update User</button>
            </div>
            <div id="editResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üóëÔ∏è Delete User</h3>
            <button onclick="selectUserToDelete()">Select User to Delete</button>
            <div id="userToDelete"></div>
            <button class="danger" onclick="deleteUser()" id="deleteBtn" style="display: none;">Confirm Delete</button>
            <div id="deleteResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üîë Reset User Password</h3>
            <button onclick="selectUserForPasswordReset()">Select User for Password Reset</button>
            <div id="userForReset"></div>
            <div id="passwordResetForm" style="display: none;">
                <div class="form-section">
                    <label>New Password (leave empty for auto-generated):</label>
                    <input type="password" id="resetPassword" placeholder="Leave empty for auto-generated">
                </div>
                <button class="warning" onclick="resetUserPassword()">Reset Password</button>
            </div>
            <div id="resetResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let authToken = '';
        let currentUsers = [];
        let selectedEditUser = null;
        let selectedDeleteUser = null;
        let selectedResetUser = null;

        // Utility functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
        }

        function showJSON(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        // Authentication functions
        async function loginAsAdmin() {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@quizora.com',
                        password: 'Admin123!'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.data.accessToken;
                    showResult('authResult', `‚úÖ Login successful! Token: ${authToken.substring(0, 50)}...`, 'success');
                } else {
                    showResult('authResult', `‚ùå Login failed: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('authResult', `‚ùå Login error: ${error.message}`, 'error');
            }
        }

        async function checkAuthStatus() {
            if (!authToken) {
                showResult('authResult', '‚ùå No token available. Please login first.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/auth/profile`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showJSON('authResult', { status: 'Authenticated', user: data.data }, 'success');
                } else {
                    showResult('authResult', `‚ùå Auth check failed: ${data.message}`, 'error');
                    authToken = '';
                }
            } catch (error) {
                showResult('authResult', `‚ùå Auth check error: ${error.message}`, 'error');
            }
        }

        // User management functions
        async function getAllUsers() {
            if (!authToken) {
                showResult('usersResult', '‚ùå Please login first.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    currentUsers = data.data.users || data.data;
                    showJSON('usersResult', { 
                        count: currentUsers.length, 
                        pagination: data.data.pagination 
                    }, 'success');
                    displayUsersList(currentUsers);
                } else {
                    showResult('usersResult', `‚ùå Failed to fetch users: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('usersResult', `‚ùå Error fetching users: ${error.message}`, 'error');
            }
        }

        async function getUserStats() {
            if (!authToken) {
                showResult('usersResult', '‚ùå Please login first.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/users/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showJSON('usersResult', data.data, 'success');
                } else {
                    showResult('usersResult', `‚ùå Failed to fetch stats: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('usersResult', `‚ùå Error fetching stats: ${error.message}`, 'error');
            }
        }

        function displayUsersList(users) {
            const container = document.getElementById('usersList');
            container.innerHTML = '';
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                
                const roleClass = `role-${user.role}`;
                
                userCard.innerHTML = `
                    <h4>${user.name} <span class="role-badge ${roleClass}">${user.role}</span></h4>
                    <div class="user-info"><strong>Email:</strong> ${user.email}</div>
                    <div class="user-info"><strong>Status:</strong> ${user.status || 'active'}</div>
                    <div class="user-info"><strong>ID:</strong> ${user._id}</div>
                    ${user.studentId ? `<div class="user-info"><strong>Student ID:</strong> ${user.studentId}</div>` : ''}
                    ${user.employeeId ? `<div class="user-info"><strong>Employee ID:</strong> ${user.employeeId}</div>` : ''}
                    ${user.course ? `<div class="user-info"><strong>Course:</strong> ${user.course}</div>` : ''}
                    ${user.department ? `<div class="user-info"><strong>Department:</strong> ${user.department}</div>` : ''}
                    <div class="user-info"><strong>Created:</strong> ${new Date(user.createdAt).toLocaleDateString()}</div>
                `;
                
                container.appendChild(userCard);
            });
        }

        // Field toggle functions
        function toggleUserFields() {
            const role = document.getElementById('newUserRole').value;
            document.getElementById('studentFields').style.display = role === 'student' ? 'block' : 'none';
            document.getElementById('teacherFields').style.display = role === 'teacher' ? 'block' : 'none';
        }

        function toggleEditUserFields() {
            const role = document.getElementById('editUserRole').value;
            document.getElementById('editStudentFields').style.display = role === 'student' ? 'block' : 'none';
            document.getElementById('editTeacherFields').style.display = role === 'teacher' ? 'block' : 'none';
        }

        // Create user function
        async function createUser() {
            if (!authToken) {
                showResult('createResult', '‚ùå Please login first.', 'error');
                return;
            }
            
            const userData = {
                name: document.getElementById('newUserName').value,
                email: document.getElementById('newUserEmail').value,
                password: document.getElementById('newUserPassword').value,
                role: document.getElementById('newUserRole').value,
                phoneNumber: document.getElementById('newUserPhone').value || undefined,
                address: document.getElementById('newUserAddress').value || undefined
            };

            if (userData.role === 'student') {
                userData.studentId = document.getElementById('newUserStudentId').value;
                userData.course = document.getElementById('newUserCourse').value;
                userData.enrollmentYear = parseInt(document.getElementById('newUserYear').value);
            } else if (userData.role === 'teacher') {
                userData.employeeId = document.getElementById('newUserEmployeeId').value;
                userData.department = document.getElementById('newUserDepartment').value;
                userData.subjects = document.getElementById('newUserSubjects').value.split(',').map(s => s.trim());
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showJSON('createResult', { message: 'User created successfully!', user: data.data.user }, 'success');
                    // Refresh users list
                    getAllUsers();
                } else {
                    showResult('createResult', `‚ùå Failed to create user: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('createResult', `‚ùå Error creating user: ${error.message}`, 'error');
            }
        }

        // Edit user functions
        function selectUserToEdit() {
            if (currentUsers.length === 0) {
                showResult('editResult', '‚ùå Please fetch users first.', 'error');
                return;
            }
            
            const userList = currentUsers.map((user, index) => 
                `${index + 1}. ${user.name} (${user.email}) - ${user.role}`
            ).join('\\n');
            
            const selection = prompt(`Select user to edit:\\n\\n${userList}\\n\\nEnter number (1-${currentUsers.length}):`);
            
            if (selection && !isNaN(selection)) {
                const index = parseInt(selection) - 1;
                if (index >= 0 && index < currentUsers.length) {
                    selectedEditUser = currentUsers[index];
                    displayEditUser();
                    populateEditForm();
                }
            }
        }

        function displayEditUser() {
            if (!selectedEditUser) return;
            
            document.getElementById('userToEdit').innerHTML = `
                <h4>Editing: ${selectedEditUser.name}</h4>
                <p><strong>Email:</strong> ${selectedEditUser.email}</p>
                <p><strong>Role:</strong> ${selectedEditUser.role}</p>
                <p><strong>Status:</strong> ${selectedEditUser.status || 'active'}</p>
                <p><strong>ID:</strong> ${selectedEditUser._id}</p>
            `;
            
            document.getElementById('editUserForm').style.display = 'block';
        }

        function populateEditForm() {
            if (!selectedEditUser) return;
            
            document.getElementById('editUserName').value = selectedEditUser.name || '';
            document.getElementById('editUserEmail').value = selectedEditUser.email || '';
            document.getElementById('editUserRole').value = selectedEditUser.role || 'student';
            document.getElementById('editUserStatus').value = selectedEditUser.status || 'active';
            document.getElementById('editUserStudentId').value = selectedEditUser.studentId || '';
            document.getElementById('editUserCourse').value = selectedEditUser.course || '';
            document.getElementById('editUserYear').value = selectedEditUser.enrollmentYear || '';
            document.getElementById('editUserEmployeeId').value = selectedEditUser.employeeId || '';
            document.getElementById('editUserDepartment').value = selectedEditUser.department || '';
            document.getElementById('editUserSubjects').value = Array.isArray(selectedEditUser.subjects) ? selectedEditUser.subjects.join(', ') : (selectedEditUser.subjects || '');
            document.getElementById('editUserPhone').value = selectedEditUser.phoneNumber || '';
            document.getElementById('editUserAddress').value = selectedEditUser.address || '';
            
            toggleEditUserFields();
        }

        async function updateUser() {
            if (!authToken || !selectedEditUser) {
                showResult('editResult', '‚ùå Please login and select a user first.', 'error');
                return;
            }
            
            const userData = {
                name: document.getElementById('editUserName').value,
                email: document.getElementById('editUserEmail').value,
                role: document.getElementById('editUserRole').value,
                status: document.getElementById('editUserStatus').value,
                phoneNumber: document.getElementById('editUserPhone').value || undefined,
                address: document.getElementById('editUserAddress').value || undefined
            };

            if (userData.role === 'student') {
                userData.studentId = document.getElementById('editUserStudentId').value;
                userData.course = document.getElementById('editUserCourse').value;
                userData.enrollmentYear = parseInt(document.getElementById('editUserYear').value);
            } else if (userData.role === 'teacher') {
                userData.employeeId = document.getElementById('editUserEmployeeId').value;
                userData.department = document.getElementById('editUserDepartment').value;
                userData.subjects = document.getElementById('editUserSubjects').value.split(',').map(s => s.trim());
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users/${selectedEditUser._id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showJSON('editResult', { message: 'User updated successfully!', user: data.data.user }, 'success');
                    // Refresh users list
                    getAllUsers();
                    // Clear selection
                    selectedEditUser = null;
                    document.getElementById('editUserForm').style.display = 'none';
                    document.getElementById('userToEdit').innerHTML = '';
                } else {
                    showResult('editResult', `‚ùå Failed to update user: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('editResult', `‚ùå Error updating user: ${error.message}`, 'error');
            }
        }

        // Delete user functions
        function selectUserToDelete() {
            if (currentUsers.length === 0) {
                showResult('deleteResult', '‚ùå Please fetch users first.', 'error');
                return;
            }
            
            const nonAdminUsers = currentUsers.filter(user => user.role !== 'admin');
            
            if (nonAdminUsers.length === 0) {
                showResult('deleteResult', '‚ùå No non-admin users available for deletion.', 'error');
                return;
            }
            
            const userList = nonAdminUsers.map((user, index) => 
                `${index + 1}. ${user.name} (${user.email}) - ${user.role}`
            ).join('\\n');
            
            const selection = prompt(`Select user to delete:\\n\\n${userList}\\n\\nEnter number (1-${nonAdminUsers.length}):`);
            
            if (selection && !isNaN(selection)) {
                const index = parseInt(selection) - 1;
                if (index >= 0 && index < nonAdminUsers.length) {
                    selectedDeleteUser = nonAdminUsers[index];
                    displayDeleteUser();
                }
            }
        }

        function displayDeleteUser() {
            if (!selectedDeleteUser) return;
            
            document.getElementById('userToDelete').innerHTML = `
                <h4>‚ö†Ô∏è DELETE: ${selectedDeleteUser.name}</h4>
                <p><strong>Email:</strong> ${selectedDeleteUser.email}</p>
                <p><strong>Role:</strong> ${selectedDeleteUser.role}</p>
                <p><strong>Status:</strong> ${selectedDeleteUser.status || 'active'}</p>
                <p><strong>ID:</strong> ${selectedDeleteUser._id}</p>
                <p style="color: red;"><strong>‚ö†Ô∏è This action cannot be undone!</strong></p>
            `;
            
            document.getElementById('deleteBtn').style.display = 'inline-block';
        }

        async function deleteUser() {
            if (!authToken || !selectedDeleteUser) {
                showResult('deleteResult', '‚ùå Please login and select a user first.', 'error');
                return;
            }
            
            const confirmation = confirm(`Are you sure you want to delete user "${selectedDeleteUser.name}"?\\n\\nThis action cannot be undone!`);
            
            if (!confirmation) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/admin/users/${selectedDeleteUser._id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showJSON('deleteResult', { message: 'User deleted successfully!', deletedUserId: data.data.deletedUserId }, 'success');
                    // Refresh users list
                    getAllUsers();
                    // Clear selection
                    selectedDeleteUser = null;
                    document.getElementById('deleteBtn').style.display = 'none';
                    document.getElementById('userToDelete').innerHTML = '';
                } else {
                    showResult('deleteResult', `‚ùå Failed to delete user: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('deleteResult', `‚ùå Error deleting user: ${error.message}`, 'error');
            }
        }

        // Password reset functions
        function selectUserForPasswordReset() {
            if (currentUsers.length === 0) {
                showResult('resetResult', '‚ùå Please fetch users first.', 'error');
                return;
            }
            
            const userList = currentUsers.map((user, index) => 
                `${index + 1}. ${user.name} (${user.email}) - ${user.role}`
            ).join('\\n');
            
            const selection = prompt(`Select user for password reset:\\n\\n${userList}\\n\\nEnter number (1-${currentUsers.length}):`);
            
            if (selection && !isNaN(selection)) {
                const index = parseInt(selection) - 1;
                if (index >= 0 && index < currentUsers.length) {
                    selectedResetUser = currentUsers[index];
                    displayResetUser();
                }
            }
        }

        function displayResetUser() {
            if (!selectedResetUser) return;
            
            document.getElementById('userForReset').innerHTML = `
                <h4>Reset Password: ${selectedResetUser.name}</h4>
                <p><strong>Email:</strong> ${selectedResetUser.email}</p>
                <p><strong>Role:</strong> ${selectedResetUser.role}</p>
                <p><strong>ID:</strong> ${selectedResetUser._id}</p>
            `;
            
            document.getElementById('passwordResetForm').style.display = 'block';
        }

        async function resetUserPassword() {
            if (!authToken || !selectedResetUser) {
                showResult('resetResult', '‚ùå Please login and select a user first.', 'error');
                return;
            }
            
            const newPassword = document.getElementById('resetPassword').value;
            const requestData = newPassword ? { newPassword } : {};

            try {
                const response = await fetch(`${API_BASE}/admin/users/${selectedResetUser._id}/reset-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showJSON('resetResult', { 
                        message: 'Password reset successfully!', 
                        temporaryPassword: data.data.temporaryPassword,
                        userId: data.data.userId || selectedResetUser._id
                    }, 'success');
                    // Clear form
                    document.getElementById('resetPassword').value = '';
                } else {
                    showResult('resetResult', `‚ùå Failed to reset password: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('resetResult', `‚ùå Error resetting password: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            showResult('authResult', 'Please login as admin to test features.', 'info');
            showResult('usersResult', 'Click "Fetch All Users" to load user data.', 'info');
        };
    </script>
</body>
</html>
